<section class="checkout-container">
  <h2>Finalizar Compra</h2>

  <div class="checkout-grid">

    <!-- FORMULARIO DE ENTREGA -->
    <div class="form-entrega">
      <h3>Tipo de entrega</h3>

      <label>
        <input type="radio" name="entrega" value="retiro" [(ngModel)]="tipoEntrega" />
        Retiro en tienda
      </label>

      <label>
        <input type="radio" name="entrega" value="delivery" [(ngModel)]="tipoEntrega" />
        Delivery (+$3.500)
      </label>

      <div *ngIf="tipoEntrega === 'delivery'" class="formulario-despacho">
        <h4>Datos de despacho</h4>

        <label for="region">Región</label>
        <select id="region" [(ngModel)]="datosDespacho.region" (change)="onRegionChange()">
          <option value="">Seleccione una región</option>
          <option *ngFor="let region of regiones" [value]="region.regionId">
            {{ region.nombre }}
          </option>
        </select>

        <label for="comuna">Comuna:</label>
        <select id="comuna" [(ngModel)]="datosDespacho.comuna_id" name="comuna">
          <option value="0" disabled>Seleccione una comuna</option>
          <option *ngFor="let comuna of comunas" [value]="comuna.id">{{ comuna.nombre }}</option>
        </select>

        <label for="calle">Calle</label>
        <input id="calle" type="text" [(ngModel)]="datosDespacho.calle" required />

        <label for="numero">Número</label>
        <input id="numero" type="text" [(ngModel)]="datosDespacho.numero" required />

        <label for="dpto">Dpto. / Casa / Oficina / Condominio (opcional)</label>
        <input id="dpto" type="text" [(ngModel)]="datosDespacho.dpto" placeholder="Ej: Dpto 203" />
      </div>
    </div>

    <!-- FORMULARIO DE INVITADO -->
    <div *ngIf="!estaLogueado" class="form-invitado">
      <h3>Tus datos</h3>

      <label for="nombre">Nombre completo</label>
      <input id="nombre" type="text" [(ngModel)]="datosUsuario.nombreCompleto" required />

      <label for="correo">Correo electrónico</label>
      <input id="correo" type="email" [(ngModel)]="datosUsuario.correo" required />

      <label for="telefono">Teléfono</label>
      <input id="telefono" type="text" [(ngModel)]="datosUsuario.telefono" required />

      <label for="rut">RUT</label>
      <input id="rut" type="text" [(ngModel)]="datosUsuario.rut" required />

      <label>
        <input type="checkbox" [(ngModel)]="deseaRegistrarse" />
        Deseo registrarme como cliente para futuras compras
      </label>
    </div>

    <!-- RESUMEN -->
    <div class="resumen-pago">
      <h3>Resumen</h3>
      <p>Productos: <strong>{{ totalProductos | currency:'CLP' }}</strong></p>
      <p *ngIf="tipoEntrega === 'delivery'">Despacho: <strong>{{ 3500 | currency:'CLP' }}</strong></p>
      <p><strong>Total a pagar: {{ totalFinal | currency:'CLP' }}</strong></p>

      <button class="btn-pagar" (click)="pagarCompra()">Pagar compra</button>
    </div>
  </div>
</section>
